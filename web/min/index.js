"use strict";let global_hue,global_cx,global_cy,connection,connected,doUpdate=!1;function sendWs(e){try{console.log(e),console.log(JSON.stringify(e)),connection.send(JSON.stringify(e))}catch(e){}}function initWs(){try{let e=new WebSocket("ws://192.168.4.1/ws"),t=new WebSocket("ws://192.168.178.90/ws");e.onopen=function(){connected||(connection=e,connected=!0,t.close(),receiveWs(),triggerSnackbar("con"))},t.onopen=function(){connected||(connection=t,connected=!0,e.close(),receiveWs(),triggerSnackbar("con"))}}catch(e){console.log(e)}}function receiveWs(){connection.onmessage=function(e){if(console.log("Received: "+e.data),"__s__"===e.data)return void triggerSnackbar("success");let t=JSON.parse(e.data);console.log(t),void 0!==t.rgb_led&&findColor(t.rgb_led[0],t.rgb_led[1],Math.pow(t.rgb_led[2],1/Math.E),!1)}}function sendWiFi(){sendWs({s_ssid:document.getElementById("s").value,s_pwd:document.getElementById("p").value})}function sendDeviceTime(){let e=new Date;sendWs({ntpTime:!1,deviceTime:!0,time:[e.getYear(),e.getMonth(),e.getDate(),e.getDay(),e.getHours(),e.getMinutes(),e.getSeconds()]})}function sendNTP(){sendWs({ntpTime:!0,deviceTime:!1,gmtOffset_sec:document.getElementById("gmtoff").value/100*3600,daylightOffset_sec:document.getElementById("dayoff").value/100*3600})}function sendALR(){let e,t,n=0;for(let e=0;e<7;e++)n|=(document.getElementById("wk"+e).checked?1:0)<<e;let o=document.getElementById("alr").value;""!==o&&sendWs({alarm:!0,re:n,a_h:e=parseInt(o.slice(0,2)),a_m:t=parseInt(o.slice(3,5)),a_vol:document.getElementById("vol").value})}function sendTz(){let e=document.getElementById("cs").options[document.getElementById("cs").selectedIndex].value,t=document.getElementById("tz"+e);sendWs({ntpTime:!0,deviceTime:!1,TZC:t.options[t.selectedIndex].value})}function setTimeSelect(){let e=document.getElementById("cs").options[document.getElementById("cs").selectedIndex].value;for(let t=0;t<10;t++)document.getElementById("tz"+t).parentElement.style.display="none",t==e&&(document.getElementById("tz"+t).parentElement.style.display="")}function toggleOp(e,t){null==e&&(e=1!=document.getElementById(t).style.opacity),e?(document.getElementById(t).style.display="",setTimeout(function(e){document.getElementById(e).style.opacity=1},10,t)):(document.getElementById(t).style.opacity=0,setTimeout(function(e){document.getElementById(e).style.display="none"},200,t))}function getNeColor(){let e=document.getElementById("ccube").getBoundingClientRect();return getColor(global_hue,global_cx+e.left,global_cy+e.top,!1)}function updateStyle(e){let t;if(void 0===e){t=(new Date).getHours()}else t=e;document.getElementById("sty").innerHTML=t>5&&t<18?":root { --bg: #e4e4e4; --sec: #eee; --text: #444; --thumb: #9D9D9D; --hov: #e5e5e5;} ":":root { --bg: #222; --sec: #333333; --text: #aaa; --thumb: #5e5e5e; --hov: #424242;} "}function draw(e){let t=document.getElementById("ccube"),n=t.scrollWidth,o=t.scrollHeight,l=document.getElementById("ccube").getContext("2d");e/=360;for(let t=0;t<=o;t+=4){let c=HSVtoRGB(e,0,t/o),d=HSVtoRGB(e,1,t/o),i=l.createLinearGradient(0,t,n,t);i.addColorStop(0,"rgb("+c.r+","+c.g+","+c.b+")"),i.addColorStop(1,"rgb("+d.r+","+d.g+","+d.b+")"),l.fillStyle=i,l.fillRect(0,o-t,n,4)}}function getColor(e,t,n,o=!0){let l=document.getElementById("ccube"),c=l.getBoundingClientRect(),d=document.getElementById("c"),i=t-c.left,a=n-c.top;i=Math.min(Math.max(i,0),l.scrollWidth),a=Math.min(Math.max(a,0),l.scrollHeight),global_cx=i,global_cy=a;let s=i/l.scrollWidth,r=(l.scrollHeight-a)/l.scrollHeight,g=HSVtoRGB(e/360,s,r);return setPreview(g),d.style="display: block; left: "+(i+c.left-11)+"px; top: "+(a+c.top-11)+"px; background-color: rgb("+g.r+","+g.g+","+g.b+");",o&&sendWs({rgb:[e/360,s,Math.pow(r,Math.E)]}),{r:g.r,g:g.g,b:g.b}}function setPreview(e){let t=1===e.r.toString(16).length?"0"+String(e.r.toString(16)):e.r.toString(16),n=1===e.g.toString(16).length?"0"+String(e.g.toString(16)):e.g.toString(16),o=1===e.b.toString(16).length?"0"+String(e.b.toString(16)):e.b.toString(16);updateIcon(e.r,e.g,e.b),document.getElementById("prev").value="#"+t+n+o,document.getElementById("acc").innerHTML=" :root { --acc: rgb("+e.r+","+e.g+","+e.b+"); }"}function findColor(e,t,n,o=!0){let l,c,d=document.getElementById("ccube"),i=d.getBoundingClientRect();global_hue=360*e,document.getElementById("hue").value=global_hue,draw(global_hue),l=t*d.scrollWidth+i.left,c=d.scrollHeight-n*d.scrollHeight+i.top,console.log(e,t,n,l,c),getColor(global_hue,l,c,o)}function updateHue(){let e=document.getElementById("ccube");doUpdate=!1,draw(global_hue=document.getElementById("hue").value),findColor(global_hue/360,global_cx/e.scrollWidth,(e.scrollHeight-global_cy)/e.scrollHeight)}function updateIcon(e,t,n){let o=document.createElement("canvas");o.width=16,o.height=16;let l=o.getContext("2d");l.fillStyle="rgb(220,220,200)",l.fillRect(0,0,16,16),l.fillStyle="rgb("+e+","+t+","+n+")",l.beginPath(),l.arc(8,8,7,0,2*Math.PI),l.fill();let c=document.querySelector("link[rel*='icon']")||document.createElement("link");c.type="image/x-icon",c.rel="shortcut icon",c.href=o.toDataURL(),document.getElementsByTagName("head")[0].appendChild(c)}function findHex(e){(e=e.slice(1,7)).length<6&&(e="0"+String(e)),findColor(parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16))}function HSVtoRGB(e,t,n){let o,l,c,d,i,a,s,r;switch(1===arguments.length&&(t=e.s,n=e.v,e=e.h),a=n*(1-t),s=n*(1-(i=6*e-(d=Math.floor(6*e)))*t),r=n*(1-(1-i)*t),d%6){case 0:o=n,l=r,c=a;break;case 1:o=s,l=n,c=a;break;case 2:o=a,l=n,c=r;break;case 3:o=a,l=s,c=n;break;case 4:o=r,l=a,c=n;break;case 5:o=n,l=a,c=s}return{r:Math.round(255*o),g:Math.round(255*l),b:Math.round(255*c)}}function RGBtoHSV(e,t,n){e/=255,t/=255,n/=255;var o,l,c=Math.max(e,t,n),d=Math.min(e,t,n),i=c,a=c-d;if(l=0===c?0:a/c,c===d)o=0;else{switch(c){case e:o=(t-n)/a+(t<n?6:0);break;case t:o=(n-e)/a+2;break;case n:o=(e-t)/a+4}o/=6}return{h:o,s:l,v:i}}function revealPass(){"password"===document.getElementById("p").type?document.getElementById("p").type="text":document.getElementById("p").type="password"}function triggerSnackbar(e){let t=document.getElementById(e);t.className.includes("show")||(t.className+=" show",setTimeout(()=>{t.className=t.className.replace("show","")},1400))}window.onload=function(){initWs(),updateStyle(),findColor(255*Math.random(),255*Math.random(),255*Math.random(),!1),setTimeSelect(0)},window.onmousemove=function(e){doUpdate&&(document.body.style.cursor="pointer",getColor(global_hue,e.clientX,e.clientY))},window.onmouseup=function(){doUpdate=!1,document.body.style.cursor="auto"},window.onscroll=function(){getNeColor()},window.onresize=function(){getNeColor()},window.onclose=function(){try{connection.close(),c_AP.close(),c_STA.close()}catch(e){}};